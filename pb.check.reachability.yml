--- 
 - name: Verify reachability by pinging directcly connected devices and the loopback address 
   hosts: junos-ssh
   connection: local
   gather_facts: no
   roles:
   - Juniper.junos

   tasks:
   - name: Check if Junos devices can ping directly connected ip addresses
     junos_ping:
        host: "{{ inventory_hostname }}"
        dest_ip: "{{ item.peer_ip }}"
        source_ip: "{{ item.local_ip }}"
        ttl: 1
     with_items:
      - "{{ neighbors }}"

   - name: Check if Junos devices can ping adjacent loopback IP addresses
     junos_ping:
        host: "{{ inventory_hostname }}"
        dest_ip: "{{ item.peer_loopback }}"
        source_ip: "{{ item.local_ip }}"
        ttl: 1
     with_items:
      - "{{ neighbors }}"
