---
 - name: create rollback directories
   hosts: localhost
   gather_facts: no
   tasks:

   - name: create rollback directory
     file:
       path: "{{playbook_dir}}/rollback"
       state: directory


   - name: create rollback subdirectories
     file:
       path: "{{playbook_dir}}/rollback/{{ item }}"
       state: directory
     with_items:
       - log
       - diff

 - name: Rollback configuration on junos devices
   hosts: junos-ssh
   roles:       
    - Juniper.junos
   connection: local
   gather_facts: no

   tasks:

   - name: Rollback junos config task
     junos_rollback:
      host: "{{ inventory_hostname }}"
      user: "{{ ADMUSER }}"
      passwd: "{{ ADMPASS }}"
      logfile: "{{playbook_dir}}/rollback/log/rollback.log"
      diffs_file: "{{playbook_dir}}/rollback/diff/{{ inventory_hostname }}.diff"
      rollback: "{{ rbid }}" 
      comment: "configuration rolled back by Ansible using rollback id {{ rbid }}"
